<!DOCTYPE html>
<html>
<head>
  <title>Udacity Todos Goals</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js"></script>
  <script src="https://unpkg.com/react@16.3.0-alpha.1/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@16.3.0-alpha.1/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
</head>
<body>
    <div>
        <h1>Todos</h1>
        <input type="text", id="todo", placeholder="Add Todo">
        <button id='todoBtn'>Add Todo</button>
        <ul id="todos"></ul>
    </div>
    <div>   
            <h1>Goals</h1>
            <input type="text", id="goal", placeholder="Add Goal">
            <button id='goalBtn'>Add Goal</button>
            <ul id="goals"></ul>
    </div>
    <hr/>
    <div id='app'></div>
    <script src="index.js"></script>
    <script type="text/javascript">
        // subscribe a new function
        store.subscribe(() => {
            const {goals, todos} = store.getState()
            
            document.getElementById('goals').innerHTML = ''
            document.getElementById('todos').innerHTML = ''
            
            goals.forEach(goal => {
                addGoalToDOM(goal)
            })
            todos.forEach(todo => {
                addTodoToDOM(todo)
            })
        })

        function generateId () {
            return Math.random().toString(36).substring(2) + (new Date()).getTime().toString(36);
        }
        function addTodo() {
            const input = document.getElementById('todo')
            const name = input.value
            input.value = ''

            store.dispatch(addTodoAction({
                id: generateId(),
                complete : false,
                name
            }))
        }

        function addGoal() {
            const input = document.getElementById('goal')
            const name = input.value
            input.value = ''

            store.dispatch(addGoalAction({
                id: generateId(),
                name
            }))
        }

        document.getElementById('todoBtn')
            .addEventListener('click', addTodo)

        document.getElementById('goalBtn')
            .addEventListener('click', addGoal) 
        
        function createRemoveButton(onClick) {
            const removeButton = document.createElement('button')
            removeButton.innerHTML = 'X'
            removeButton.addEventListener('click', onClick)
            return removeButton        
        }

        function addTodoToDOM(todo) {
            const node = document.createElement('li')
            const text = document.createTextNode(todo.name)

            removeButton = createRemoveButton(() => {
                store.dispatch(removeTodoAction(todo.id))
            })

            node.appendChild(text)
            node.appendChild(removeButton)
            node.style.textDecoration = todo.complete ? 'line-through' : 'none'
            node.addEventListener('click', () => {
                store.dispatch(toggleTodoAction(todo.id))
            })
            document.getElementById('todos').appendChild(node)
        }

        function addGoalToDOM(goal) {
            const node = document.createElement('li')
            const text = document.createTextNode(goal.name)

            removeButton = createRemoveButton(() => {
                store.dispatch(removeGoalAction(goal.id))
            })
            node.appendChild(text)
            node.appendChild(removeButton)
            document.getElementById('goals').appendChild(node)
        }   
    </script>
    <script type="text/babel">
        function List(props) {
            console.log(props)
            return <ul>
                    {
                        props.items.map((item) => (
                            <li key={item.id}>
                                <span>{item.name}</span>
                                <button
                                    onClick={() => props.removeItem(item)}
                                >X</button>
                            </li>
                        ))
                    }
                </ul>
        }
        class Todos extends React.Component {
            addItem = (event) => {
                event.preventDefault()
                const name = this.input.value
                this.input.value = ''
                this.props.store.dispatch(addTodoAction({
                    id: generateId(),
                    complete : false,
                    name
                }))
            }
            removeItem = (todo) => {
                this.props.store.dispatch(removeTodoAction(todo.id))
            }
            render() {
                return <div>
                        <h1>Todo List</h1>
                        <input
                            type="text"
                            placeholder='Add Todo'
                            ref={(input) => this.input = input}
                        /> 
                        <button onClick={this.addItem}>Add Todo</button>
                        <List removeItem={this.removeItem} items={this.props.todos}/>
                    </div>
            }    
        }
        class Goals extends React.Component {
            addItem = (event) => {
                event.preventDefault()
                const name = this.input.value
                this.input.value = ''
                this.props.store.dispatch(addGoalAction({
                    id: generateId(),
                    name
                }))
            }
            removeItem = (goal) => {
                this.props.store.dispatch(removeGoalAction(goal.id))
            }
            render() {
                return <div>
                        <h1>Goal List</h1>
                        <input
                            type="text"
                            placeholder='Add Goal'
                            ref={(input) => this.input = input}
                        /> 
                        <button onClick={this.addItem}>Add Goal</button>
                        <List removeItem={this.removeItem} items={this.props.goals}/>
                    </div>
            }    
        }      
        class App extends React.Component {
            componentDidMount() {
                this.props.store.subscribe(() => this.forceUpdate())
            }
            render() {
                const {store} = this.props
                const {todos, goals} = store.getState()
                return <div>
                        <Todos todos={todos} store={store}/>
                        <Goals goals={goals} store={store}/>
                      </div>
            }
        }
        ReactDOM.render(
            <App store={store}/>,
            document.getElementById('app')
        )
    </script>

</body>
</html> 